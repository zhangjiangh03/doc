---
title: 文件指针的定位
date: 2022-09-25 10:22:00
categories:
- C语言
tags:
- C语言
---

<style>.center {width: auto;display: table;margin-left: auto;margin-right: auto;}</style>
在 C 语言中，可以使用文件指针进行文件的读写操作。
文件指针是记录文件位置的一种特殊指针，在打开文件时，文件指针指向文件的开头。

## 文件指针的类型

在 C 语言中，文件指针的类型为`FILE`，定义在`<stdio.h>`头文件中。
我们通常使用`fopen`函数打开一个文件并返回一个文件指针，该文件指针用于标识该文件：

```c
FILE *fp = fopen("example.txt", "r");
```

## 文件指针的定位

C 语言提供了一系列函数用于定位文件指针的位置，这些函数包括：

- `fseek`函数：将文件指针定位到指定的位置。
- `ftell`函数：获取当前文件指针的位置。

### fseek函数

fseek 函数用于将文件指针定位到指定位置。

```text
int fseek(FILE *stream, long int offset, int whence);
```

其中，`stream`是要进行定位的文件指针；`offset`是偏移量，表示从`whence`指定的位置开始移动的距离；`whence`是基准位置，可以取以下值：

<div class="center">

|常量|含义|
|:---:|:---|
|SEEK_SET|文件开头|
|SEEK_CUR|当前文件指针位置|
|SEEK_END|文件结尾|

</div>

例如，以下代码将文件指针`fp`定位到文件开头：

```c
fseek(fp, 0, SEEK_SET);
```

### ftell 函数

`ftell`函数可以返回当前文件指针的位置，函数原型如下：

```text
long int ftell(FILE *stream);
```

例如，以下代码返回文件指针`fp`的当前位置：

```c
long int pos = ftell(fp);
```

## 示例

```c
#include <stdio.h>

int main() {
    FILE *fp = fopen("example.txt", "r");
    if (fp == NULL) {
        printf("Open file failed.\n");
        return -1;
    }

    // 将文件指针定位到文件末尾
    fseek(fp, 0, SEEK_END);

    // 获取当前文件指针的位置
    long int pos = ftell(fp);

    printf("File size is %ld bytes.\n", pos);

    fclose(fp);
    return 0;
}
```

上面的代码先使用`fopen`函数打开文件`example.txt`并获取文件指针`fp`，然后使用 `fseek`函数将文件指针定位到文件末尾，并使用`ftell`函数获取当前文件指针的位置，即文件的大小。
最后，我们输出文件的大小并关闭文件。

## 注意事项

在使用 fseek 函数定位文件指针时，需要注意以下几点：

- `offset`参数必须是一个长整型数值。如果使用`int`类型，可能会导致文件指针无法定位到正确的位置。
- 在使用`whence = SEEK_CUR`定位文件指针时，`offset`参数可以为负数。如果`offset`参数为负数，表示向文件开头方向移动文件指针。
- 在使用`whence = SEEK_END`定位文件指针时，`offset`参数必须是一个负数，表示向文件开头方向移动文件指针。