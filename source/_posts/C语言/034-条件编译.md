---
title: 条件编译
date: 2022-09-25 10:30:00
categories:
- C语言
tags:
- C语言基础
---

条件编译是一种在程序编译时进行决策的技术，可以根据不同的条件选择是否编译某段代码。
C语言提供了预编译指令（Preprocessor Directive）来实现条件编译。

## 常用的预编译指令

### `#define`、`#undef`

`#define`指令用于定义一个宏（Macro），可以用来代替一段代码或者一个常量。

```c
#define MAX_NUM 100
...
int a[MAX_NUM];
```

这里定义了一个常量`MAX_NUM`，可以在后面使用。
在需要取消宏定义时，可以使用`#undef`指令：

```text
#undef MAX_NUM
```

### `#ifdef`、`#ifndef`、`#endif`

`#ifdef`和`#ifndef`指令分别用于判断某个宏是否已经被定义或者未被定义。

```c
#ifdef __DEBUG__
    printf("Debug mode.\n");
#endif

#ifndef __DEBUG__
    printf("Release mode.\n");
#endif
```

如果`__DEBUG__`已经被定义，则输出`Debug mode.`，否则输出`Release mode.`。
在使用`#ifdef`或`#ifndef`时，必须要有相应的`#endif`指令，用于结束条件编译区块。

### `#if`、`#elif`、`#else`

`#if`指令用于判断一个表达式是否成立，并根据结果选择是否编译某段代码。

```c
#if OS == WINDOWS
    #include <windows.h>
#elif OS == LINUX
    #include <unistd.h>
#endif
```

这里判断操作系统是否为`WINDOWS`或者`LINUX`，然后选择是否包含相应的头文件。
在`#if`的条件中，可以使用逻辑运算符、比较运算符和预定义宏等。

## 预定义宏

C语言中已经定义了一些特殊的宏，可以在程序中使用，例如：

- `FIL`E：当前源文件名。
- `LINE`：当前行号。
- `DATE`：当前编译日期。
- `TIME`：当前编译时间。

这些宏可以用于调试和输出信息。