---
title: 文件的打开和关闭
date: 2022-12-25 13:45:00
categories:
- C语言
tags:
- C语言基础
---

<style>.center {width: auto;display: table;margin-left: auto;margin-right: auto;}</style>
在编程中，经常需要对文件进行读写操作。C 语言提供了一组标准库函数，方便我们进行文件的打开和关闭操作。

## 打开文件

在 C 语言中，可以使用`fopen`函数打开一个文件，并返回一个指向该文件的指针。

```text
FILE *fopen(const char *filename, const char *mode);
```

其中，`filename`是需要打开的文件名，`mode`表示打开文件的模式。
`fopen`函数打开文件的模式参数有以下几种：

<div class="center">

|模式|含义|
|:---:|:---|
|r|只读模式。文件必须存在，否则返回 NULL。|
|w|写模式。如果文件不存在，会创建文件；如果文件已经存在，则清空文件内容。|
|a|追加模式。如果文件不存在，会创建文件；如果文件已经存在，则在文件末尾追加数据。|
|r+|读写模式。文件必须存在，可以读取和写入文件。|
|w+|读写模式。如果文件不存在，会创建文件；如果文件已经存在，则清空文件内容，然后读取和写入文件。|
|a+|读写模式。如果文件不存在，会创建文件；如果文件已经存在，则在文件末尾追加数据，然后可以读取和写入文件。|

</div>

```c
FILE *fp = fopen("example.txt", "r");
```

## 关闭文件

在 C 语言中，可以使用`fclose`函数关闭一个打开的文件。`fclose`函数需要传入一个指向打开文件的指针。

```c
int fclose(FILE *stream);
```

```c
fclose(fp);
```

## 完整示例

文件的打开、写入和关闭：

```c
#include <stdio.h>

int main() {
    FILE *fp = fopen("example.txt", "w");
    if (fp == NULL) {
        printf("Open file failed.\n");
        return -1;
    }

    fprintf(fp, "Hello World\n");
    fclose(fp);
    return 0;
}
```

上面的代码打开名为`example.txt`的文件，并将字符串`Hello World`写入到文件中，最后关闭文件。

## 注意事项

在进行文件操作时，需要注意以下几点：

- 在打开文件之前，我们必须确保文件所在的目录存在，并且程序有读写权限。
- 在使用`fopen`函数打开文件之后，程序应该检查返回值是否为`NULL`，以确保文件成功打开。
- 在写入文件时，我们应该确保文件已经成功打开，并且拥有正确的写权限。
- 在使用完文件之后，我们应该使用`fclose`函数关闭文件。如果程序崩溃或者意外终止，可能会导致打开的文件没有被关闭。因此，为了保证文件资源能够正确释放，我们可以使用`atexit`函数在程序退出时自动关闭文件。

```c
void close_file() {
    fclose(fp);
}

int main() {
    atexit(close_file);
    ...
}
```